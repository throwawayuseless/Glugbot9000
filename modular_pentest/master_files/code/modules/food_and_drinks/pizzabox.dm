/datum/supply_pack/food/pizza/fill(obj/structure/closet/crate/C)
	. = ..()
	for(var/obj/item/pizzabox/P in C)
		if(prob(0.5)) //0.5% chance for each box
			var/obj/item/pizzabox/infinite/fourfiveeight = new(C)
			fourfiveeight.boxtag = P.boxtag
			qdel(P)

//An anomalous pizza box that, when opened, produces the opener's favorite kind of pizza.
/obj/item/pizzabox/infinite
	resistance_flags = FIRE_PROOF | LAVA_PROOF | ACID_PROOF //hard to destroy
	can_open_on_fall = FALSE
	var/list/pizza_types = list(
		/obj/item/reagent_containers/food/snacks/pizza/meat = 1,
		/obj/item/reagent_containers/food/snacks/pizza/mushroom = 1,
		/obj/item/reagent_containers/food/snacks/pizza/margherita = 1,
		/obj/item/reagent_containers/food/snacks/pizza/sassysage = 0.8,
		/obj/item/reagent_containers/food/snacks/pizza/vegetable = 0.8,
		/obj/item/reagent_containers/food/snacks/pizza/pineapple = 0.5,
		/obj/item/reagent_containers/food/snacks/pizza/donkpocket = 0.3,
		/obj/item/reagent_containers/food/snacks/pizza/dank = 0.1) //pizzas here are weighted by chance to be someone's favorite
	var/static/list/pizza_preferences

/obj/item/pizzabox/infinite/Initialize()
	. = ..()
	if(!pizza_preferences)
		pizza_preferences = list()

/obj/item/pizzabox/infinite/examine(mob/user)
	. = ..()
	if(isobserver(user))
		. += "<span class='deadsay'>This pizza box is anomalous, and will produce infinite pizza.</span>"

/obj/item/pizzabox/infinite/attack_self(mob/living/user)
	QDEL_NULL(pizza)
	if(ishuman(user))
		attune_pizza(user)
	. = ..()

/obj/item/pizzabox/infinite/proc/attune_pizza(mob/living/carbon/human/noms) //tonight on "proc names I never thought I'd type"
	if(!pizza_preferences[noms.ckey])
		pizza_preferences[noms.ckey] = pick_weight(pizza_types)
		if(noms.has_quirk(/datum/quirk/pineapple_liker))
			pizza_preferences[noms.ckey] = /obj/item/reagent_containers/food/snacks/pizza/pineapple
		else if(noms.has_quirk(/datum/quirk/pineapple_hater))
			var/list/pineapple_pizza_liker = pizza_types.Copy()
			pineapple_pizza_liker -= /obj/item/reagent_containers/food/snacks/pizza/pineapple
			pizza_preferences[noms.ckey] = pick_weight(pineapple_pizza_liker)
		else if(noms.mind && noms.mind.assigned_role == "Botanist")
			pizza_preferences[noms.ckey] = /obj/item/reagent_containers/food/snacks/pizza/dank

	var/obj/item/pizza_type = pizza_preferences[noms.ckey]
	pizza = new pizza_type (src)
	pizza.foodtype = noms.dna.species.liked_food //it's our favorite!
